
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Annolid (A segmenation based on mutiple animal tracking package) &#8212; Annolid Documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/cpl_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Annolid Documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/README.html">
   Annolid Documentation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/high_level_overview.html">
   High level overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/how_to_install.html">
   How to install
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/docker_container.html">
   Docker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/gui_or_cli.html">
   GUI or CLI ?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/labelling_images.html">
   How to label images
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/tips_and_tricks.html">
   Tips and tricks
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Annolid Zoo
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/annolid_zoo.html">
   Annolid ModelZoo
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Community
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/contributing.html">
   New contributor guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/get_in_touch.html">
   Get in touch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/licence.html">
   Licence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/cite_annolid.html">
   Cite Annolid
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/work_based_on_annolid.html">
   Work based on annolid
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/tutorials/tutorials/Train_networks_tutorial_v1.0.1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jeremyforest/annolid/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/jeremyforest/annolid//issues/new?title=Issue%20on%20page%20%2Ftutorials/tutorials/Train_networks_tutorial_v1.0.1.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/jeremyforest/annolid/master?urlpath=tree/book/tutorials/tutorials/Train_networks_tutorial_v1.0.1.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Annolid (A segmenation based on mutiple animal tracking package)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#runtime-environment-in-google-colab">
     Runtime environment in Google Colab
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-to-use-the-free-gpu">
       How to use the free GPU?
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#yolact-you-only-look-at-coefficients">
     YOLACT(You Only Look At CoefficienTs)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reference">
     Reference
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-required-packages">
   Install required packages
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clone-and-install-annolid-from-github">
     Clone and install Annolid from GitHub
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#please-uncomment-the-following-cell-and-update-opencv-python-in-colab-for-the-errors-as-follows">
       Please uncomment the following cell and update opencv-python in Colab for the errors as follows.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dcnv2">
     DCNv2
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-pretrained-weights">
     Download Pretrained Weights
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-a-model">
     Train a model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-an-example-dataset">
     Download an example dataset
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#start-tensorboard">
     Start Tensorboard
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mount-your-google-drive">
     Mount your GOOGLE Drive
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-a-trained-model-to-your-google-drive">
     Save a trained model to your Google Drive
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-original-video-and-test-it-based-on-your-trained-model">
     Download the original video and test it based on your trained model
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Annolid (A segmenation based on mutiple animal tracking package)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Annolid (A segmenation based on mutiple animal tracking package)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#runtime-environment-in-google-colab">
     Runtime environment in Google Colab
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-to-use-the-free-gpu">
       How to use the free GPU?
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#yolact-you-only-look-at-coefficients">
     YOLACT(You Only Look At CoefficienTs)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reference">
     Reference
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-required-packages">
   Install required packages
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clone-and-install-annolid-from-github">
     Clone and install Annolid from GitHub
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#please-uncomment-the-following-cell-and-update-opencv-python-in-colab-for-the-errors-as-follows">
       Please uncomment the following cell and update opencv-python in Colab for the errors as follows.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dcnv2">
     DCNv2
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-pretrained-weights">
     Download Pretrained Weights
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-a-model">
     Train a model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-an-example-dataset">
     Download an example dataset
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#start-tensorboard">
     Start Tensorboard
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mount-your-google-drive">
     Mount your GOOGLE Drive
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-a-trained-model-to-your-google-drive">
     Save a trained model to your Google Drive
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-original-video-and-test-it-based-on-your-trained-model">
     Download the original video and test it based on your trained model
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a href="https://colab.research.google.com/github/healthonrails/annolid/blob/main/docs/tutorials/Train_networks_tutorial_v1.0.1.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="tex2jax_ignore mathjax_ignore section" id="annolid-a-segmenation-based-on-mutiple-animal-tracking-package">
<h1>Annolid (A segmenation based on mutiple animal tracking package)<a class="headerlink" href="#annolid-a-segmenation-based-on-mutiple-animal-tracking-package" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will show how to track multiple animals by detection and instance segmentation. The instance segmenatation on images and video is based on <a class="reference external" href="https://github.com/dbolya/yolact">YOLACT</a>.</p>
<div class="section" id="runtime-environment-in-google-colab">
<h2>Runtime environment in Google Colab<a class="headerlink" href="#runtime-environment-in-google-colab" title="Permalink to this headline">¶</a></h2>
<p>Colab is google’s free version of Jupyter notebook.
This notebook is only tested inside Colab. It might not run in your workstation esp if you are running Windows system.</p>
<div class="section" id="how-to-use-the-free-gpu">
<h3>How to use the free GPU?<a class="headerlink" href="#how-to-use-the-free-gpu" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Click  <strong>Runtime</strong> &gt; <strong>Change Runtime Type</strong></p></li>
<li><p>Choose <strong>GPU</strong> &gt; <strong>Save</strong></p></li>
</ul>
</div>
</div>
<div class="section" id="yolact-you-only-look-at-coefficients">
<h2>YOLACT(You Only Look At CoefficienTs)<a class="headerlink" href="#yolact-you-only-look-at-coefficients" title="Permalink to this headline">¶</a></h2>
<p>A simple, fully convolutional model for real-time instance segmentation. This is the code for their papers:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://arxiv.org/abs/1904.02689">YOLACT: Real-time Instance Segmentation</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/1912.06218">YOLACT++: Better Real-time Instance Segmentation</a></p></li>
</ul>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@inproceedings</span><span class="p">{</span><span class="n">yolact</span><span class="o">-</span><span class="n">iccv2019</span><span class="p">,</span>
  <span class="n">author</span>    <span class="o">=</span> <span class="p">{</span><span class="n">Daniel</span> <span class="n">Bolya</span> <span class="ow">and</span> <span class="n">Chong</span> <span class="n">Zhou</span> <span class="ow">and</span> <span class="n">Fanyi</span> <span class="n">Xiao</span> <span class="ow">and</span> <span class="n">Yong</span> <span class="n">Jae</span> <span class="n">Lee</span><span class="p">},</span>
  <span class="n">title</span>     <span class="o">=</span> <span class="p">{</span><span class="n">YOLACT</span><span class="p">:</span> <span class="p">{</span><span class="n">Real</span><span class="o">-</span><span class="n">time</span><span class="p">}</span> <span class="n">Instance</span> <span class="n">Segmentation</span><span class="p">},</span>
  <span class="n">booktitle</span> <span class="o">=</span> <span class="p">{</span><span class="n">ICCV</span><span class="p">},</span>
  <span class="n">year</span>      <span class="o">=</span> <span class="p">{</span><span class="mi">2019</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@misc</span><span class="p">{</span><span class="n">yolact</span><span class="o">-</span><span class="n">plus</span><span class="o">-</span><span class="n">arxiv2019</span><span class="p">,</span>
  <span class="n">title</span>         <span class="o">=</span> <span class="p">{</span><span class="n">YOLACT</span><span class="o">++</span><span class="p">:</span> <span class="n">Better</span> <span class="n">Real</span><span class="o">-</span><span class="n">time</span> <span class="n">Instance</span> <span class="n">Segmentation</span><span class="p">},</span>
  <span class="n">author</span>        <span class="o">=</span> <span class="p">{</span><span class="n">Daniel</span> <span class="n">Bolya</span> <span class="ow">and</span> <span class="n">Chong</span> <span class="n">Zhou</span> <span class="ow">and</span> <span class="n">Fanyi</span> <span class="n">Xiao</span> <span class="ow">and</span> <span class="n">Yong</span> <span class="n">Jae</span> <span class="n">Lee</span><span class="p">},</span>
  <span class="n">year</span>          <span class="o">=</span> <span class="p">{</span><span class="mi">2019</span><span class="p">},</span>
  <span class="n">eprint</span>        <span class="o">=</span> <span class="p">{</span><span class="mf">1912.06218</span><span class="p">},</span>
  <span class="n">archivePrefix</span> <span class="o">=</span> <span class="p">{</span><span class="n">arXiv</span><span class="p">},</span>
  <span class="n">primaryClass</span>  <span class="o">=</span> <span class="p">{</span><span class="n">cs</span><span class="o">.</span><span class="n">CV</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This notebook was inspired and modified from <a class="reference external" href="https://colab.research.google.com/drive/1ncRxvmNR-iTtQCscj2UFSGV8ZQX_LN0M">https://colab.research.google.com/drive/1ncRxvmNR-iTtQCscj2UFSGV8ZQX_LN0M</a>.
<a class="reference external" href="https://www.immersivelimit.com/tutorials/yolact-with-google-colab">https://www.immersivelimit.com/tutorials/yolact-with-google-colab</a></p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="install-required-packages">
<h1>Install required packages<a class="headerlink" href="#install-required-packages" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Cython needs to be installed before pycocotools
!pip install cython
!pip install opencv-python pillow pycocotools matplotlib 
!pip install -U PyYAML
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!nvidia-smi
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># DCNv2 will not work if Pytorch is greater than 1.4.0
!pip install torchvision==0.5.0
!pip install torch==1.4.0
</pre></div>
</div>
</div>
</div>
<div class="section" id="clone-and-install-annolid-from-github">
<h2>Clone and install Annolid from GitHub<a class="headerlink" href="#clone-and-install-annolid-from-github" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># The root folder
%cd /content
# Clone the repo
!git clone --recurse-submodules https://github.com/healthonrails/annolid.git
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># install annolid
%cd /content/annolid/
!pip install -e .
</pre></div>
</div>
</div>
</div>
<div class="section" id="please-uncomment-the-following-cell-and-update-opencv-python-in-colab-for-the-errors-as-follows">
<h3>Please uncomment the following cell and update opencv-python in Colab for the errors as follows.<a class="headerlink" href="#please-uncomment-the-following-cell-and-update-opencv-python-in-colab-for-the-errors-as-follows" title="Permalink to this headline">¶</a></h3>
<p>File “<a class="reference external" href="http://eval.py">eval.py</a>”, line 804, in cleanup_and_exit cv2.destroyAllWindows() cv2.error: OpenCV(4.1.2) /io/opencv/modules/highgui/src/window.cpp:645: error: (-2:Unspecified error) The function is not implemented. Rebuild the library with Windows, GTK+ 2.x or Cocoa support. If you are on Ubuntu or Debian, install libgtk2.0-dev and pkg-config, then re-run cmake or configure script in function ‘cvDestroyAllWindows’</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install -U opencv-python</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="dcnv2">
<h2>DCNv2<a class="headerlink" href="#dcnv2" title="Permalink to this headline">¶</a></h2>
<p>If you want to use YOLACT++, compile deformable convolutional layers (from DCNv2).</p>
<p>Note: Make sure you have selected GPU option as discribed in the previous cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Change to the DCNv2 directory
%cd /content/annolid/annolid/segmentation/yolact/external/DCNv2

# Build DCNv2
!python setup.py build develop
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="download-pretrained-weights">
<h2>Download Pretrained Weights<a class="headerlink" href="#download-pretrained-weights" title="Permalink to this headline">¶</a></h2>
<p>We need to download pre-trained weights for inference. The creator of the GitHub repo shared them on Google Drive. We’re going to use a <strong>gdown</strong> to easily access the Drive file from Colab.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Make sure we&#39;re in the yolact folder
%cd /content/annolid/annolid/segmentation/

# Create a new directory for the pre-trained weights
!mkdir -p /content/annolid/annolid/segmentation/yolact/weights

# Download the file
!gdown --id 1ZPu1YR2UzGHQD0o1rEqy-j5bmEm3lbyP -O ./yolact/weights/yolact_plus_resnet50_54_800000.pth
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="train-a-model">
<h2>Train a model<a class="headerlink" href="#train-a-model" title="Permalink to this headline">¶</a></h2>
<p>You can let the model traing for a few hours. Click the stop by for the cell will interrupt the training and save a interrupted model.
Then you can eval the model based with a save model in the yolact/weigths folder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Check the GPU availbe for your run
!nvidia-smi
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="download-an-example-dataset">
<h2>Download an example dataset<a class="headerlink" href="#download-an-example-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#https://drive.google.com/file/d/1_kkJ8rlnoMymj0uw8VZkVEuFIMfLDwPh/view?usp=sharing
!gdown --id 1_kkJ8rlnoMymj0uw8VZkVEuFIMfLDwPh -O /content/novelctrl_coco_dataset.zip
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">shell</span>
<span class="c1">#rm -rf /content/novelctrl_coco_dataset//</span>
<span class="c1">#rm -rf /content/annolid/annolid/datasets/novelctrl_coco_dataset</span>
<span class="n">unzip</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">novelctrl_coco_dataset</span><span class="o">.</span><span class="n">zip</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">novelctrl_coco_dataset</span><span class="o">/</span>
<span class="c1"># the following command is only for the demo dataset with relative </span>
<span class="c1"># paths to the dataset in the dataset data.yaml file.</span>
<span class="n">mv</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">novelctrl_coco_dataset</span><span class="o">/</span><span class="n">novelctrl_coco_dataset</span><span class="o">/</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">annolid</span><span class="o">/</span><span class="n">annolid</span><span class="o">/</span><span class="n">datasets</span><span class="o">/</span>
</pre></div>
</div>
</div>
</div>
<p>Note please change the path highlighted with ** ** as in the e.g. config data.yaml file to your dataset’s location.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>DATASET:
    name: <span class="s1">&#39;novelctrl&#39;</span>
    train_info: <span class="s1">&#39;**/Users/xxxxxx/xxxxxx/novelctrl_coco_dataset/***train/annotations.json&#39;</span>
    train_images: <span class="s1">&#39;**/Users/xxxxxx/xxxxxx/novelctrl_coco_dataset/**train&#39;</span>
    valid_info: <span class="s1">&#39;**/Users/xxxxxx/xxxxxx/novelctrl_coco_dataset/**valid/annotations.json&#39;</span>
    valid_images: <span class="s1">&#39;**/Users/xxxxxx/xxxxxx/novelctrl_coco_dataset/**valid&#39;</span>
    class_names: <span class="o">[</span><span class="s1">&#39;nose&#39;</span>, <span class="s1">&#39;left_ear&#39;</span>, <span class="s1">&#39;right_ear&#39;</span>, <span class="s1">&#39;centroid&#39;</span>, <span class="s1">&#39;tail_base&#39;</span>, <span class="s1">&#39;tail_end&#39;</span>, <span class="s1">&#39;grooming&#39;</span>, <span class="s1">&#39;rearing&#39;</span>, <span class="s1">&#39;object_investigation&#39;</span>, <span class="s1">&#39;left_lateral&#39;</span>, <span class="s1">&#39;right_lateral&#39;</span>, <span class="s1">&#39;wall_1&#39;</span>, <span class="s1">&#39;wall_2&#39;</span>, <span class="s1">&#39;wall_3&#39;</span>, <span class="s1">&#39;wall_4&#39;</span>, <span class="s1">&#39;object_1&#39;</span>, <span class="s1">&#39;object_2&#39;</span>, <span class="s1">&#39;object_3&#39;</span>, <span class="s1">&#39;object_4&#39;</span>, <span class="s1">&#39;object_5&#39;</span>, <span class="s1">&#39;object_6&#39;</span>, <span class="s1">&#39;mouse&#39;</span><span class="o">]</span>
YOLACT:
    name: <span class="s1">&#39;novelctrl&#39;</span>
    dataset: <span class="s1">&#39;dataset_novelctrl_coco&#39;</span>
    max_size: <span class="m">512</span>
</pre></div>
</div>
</div>
<div class="section" id="start-tensorboard">
<h2>Start Tensorboard<a class="headerlink" href="#start-tensorboard" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start tensorboard for visualization of training</span>
<span class="o">%</span><span class="n">cd</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">annolid</span><span class="o">/</span><span class="n">annolid</span><span class="o">/</span><span class="n">segmentation</span><span class="o">/</span><span class="n">yolact</span><span class="o">/</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">tensorboard</span>
<span class="o">%</span><span class="n">tensorboard</span> <span class="o">--</span><span class="n">logdir</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">annolid</span><span class="o">/</span><span class="n">runs</span><span class="o">/</span><span class="n">logs</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%cd /content/annolid/annolid/segmentation/yolact/
!python train.py --config=../../datasets/novelctrl_coco_dataset/data.yaml --batch_size=16 --keep_latest_interval=100 # --resume=weights/novelctrl_244_2202_interrupt.pth --start_iter=244
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="mount-your-google-drive">
<h2>Mount your GOOGLE Drive<a class="headerlink" href="#mount-your-google-drive" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-a-trained-model-to-your-google-drive">
<h2>Save a trained model to your Google Drive<a class="headerlink" href="#save-a-trained-model-to-your-google-drive" title="Permalink to this headline">¶</a></h2>
<p>Please replace and put your_model_xxx.pth</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># e.g. 
!cp /content/annolid/annolid/segmentation/yolact/weights/your_model_xxxx.pth /content/drive/My\ Drive
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># optional</span>
<span class="c1">#!cp /content/annolid/annolid/segmentation/yolact/weights/resnet50-19c8e357.pth /content/drive/My\ Drive</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="download-the-original-video-and-test-it-based-on-your-trained-model">
<h2>Download the original video and test it based on your trained model<a class="headerlink" href="#download-the-original-video-and-test-it-based-on-your-trained-model" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># https://drive.google.com/file/d/1_UDnyYKQplOLMzv1hphk1gVqepmLeyGD/view?usp=sharing
!gdown --id 1_UDnyYKQplOLMzv1hphk1gVqepmLeyGD -O /content/novelctrl.mkv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!python eval.py --trained_model=weights/novelctrl_xxxx_xxxx.pth --config=../../datasets/novelctrl_coco/data.yaml --score_threshold=0.15 --top_k=9 --video_multiframe=1 --video=/content/novelctrl.mkv:novelctrl_tracked.mkv --display_mask=False --mot
</pre></div>
</div>
</div>
</div>
<p>The output results are located at /content/annolid/annolid/segmentation/yolact/results.</p>
<p>tracking_results.csv</p>
<p>xxxx_video_tracked.mp4</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials/tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Chen Yang, Jeremy Forest, Matthew Einhorn, Thomas Cleland<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>